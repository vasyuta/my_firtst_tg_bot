import requests
import telebot
from bs4 import BeautifulSoup as b
from telebot import types
from datetime import datetime

den = datetime.today().strftime("%d" + "." + "%m" + "." + "%Y")

API_KEY = '5867077652:AAEOazAHPbt0p4nFFFjfyyMwIOnQpTz2hPo'
yandex = 'https://poezdato.net/raspisanie-poezdov/novodachnaya--okruzhnaya/' + den + '/'
print(yandex)
er2r = f'–≠–†2–† ‚Äî –æ–¥–∏–Ω –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –º–∞—Å—Å–æ–≤—ã—Ö —ç–ª–µ–∫—Ç—Ä–æ–ø–æ–µ–∑–¥–æ–≤ –°–°–°–†. –ü—Ä–æ–∏–∑–≤–æ–¥–∏–ª—Å—è –≤ ' +\
       f'–†–∏–≥–µ, —Å–¥–µ–ª–∞–Ω–æ 1024 –≤–∞–≥–æ–Ω–∞ (—ç—Ç–æ 20 –∫–º —Å–ø–ª–æ—à–Ω–æ–π —ç–ª–µ–∫—Ç—Ä–∏—á–∫–∏!)\n–ì–ª–∞–≤–Ω–æ–π ' +\
       f'–Ω–æ–≤–∏–Ω–∫–æ–π –≠–†2–† —Å—Ç–∞–ª–æ —Ä–µ–∫—É–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ-—Ä–µ–æ—Å—Ç–∞—Ç–Ω–æ–µ —Ç–æ—Ä–º–æ–∂–µ–Ω–∏–µ, —Ä–∞–±–æ—Ç–∞—é—â–µ–µ ' +\
       f'–Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—è—Ö –±–æ–ª–µ–µ 50 –∫–º/—á –±–ª–∞–≥–æ–¥–∞—Ä—è –≤—ã—Ä–∞–±–æ—Ç–∫–µ —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–∞ ' +\
       f'–æ–±—Ä–∞—Ç–Ω–æ –≤ –∫–æ–Ω—Ç–∞–∫—Ç–Ω—É—é —Å–µ—Ç—å. –î–∞–ª—å—à–µ —É–∂–µ –ø–æ–µ–∑–¥ —Ç–æ—Ä–º–æ–∑–∏–ª —Å–≤–æ–∏–º–∏ ' +\
       f'—Ä–µ–æ—Å—Ç–∞—Ç–∞–º–∏, –∏, –Ω–∞–∫–æ–Ω–µ—Ü, –ø—Ä–æ—Å—Ç–æ —Ç—Ä–µ–Ω–∏–µ–º ‚Äî –∫–æ–ª–æ–¥–∫–∞–º–∏. –ü—Ä–∏ —ç—Ç–æ–º –≤–µ—Å ' +\
       f'—ç–ª–µ–∫—Ç—Ä–æ–ø–æ–µ–∑–¥–∞ —É–≤–µ–ª–∏—á–∏–ª—Å—è, –ø–æ—ç—Ç–æ–º—É –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞–º –ø—Ä–∏—à–ª–æ—Å—å —Å–æ–∫—Ä–∞—Ç–∏—Ç—å ' +\
       f'–¥–ª–∏–Ω—É –≤–∞–≥–æ–Ω–∞ –∏ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –±–æ–ª–µ–µ –≤—ã–Ω–æ—Å–ª–∏–≤—ã–µ —Ç–µ–ª–µ–∂–∫–∏ –¢–£–†-01.\n' +\
       f'–ï—Å–ª–∏ —Ç—ã –ø–æ–º–Ω–∏—à—å –ø—Ä–∏—è—Ç–Ω–æ–µ –≥—É–¥–µ–Ω–∏–µ —ç–ª–µ–∫—Ç—Ä–∏—á–∫–∏ –≤ —Ä–∞–Ω–Ω–µ–º –¥–µ—Ç—Å—Ç–≤–µ ‚Äî —Å–∫–æ—Ä–µ–µ ' +\
       f'–≤—Å–µ–≥–æ, —ç—Ç–æ –±—ã–ª –∏–º–µ–Ω–Ω–æ –≠–†2–†. –ù–∞ —Ñ–æ—Ç–æ: –≠–†2–† –Ω–µ—Å—ë—Ç—Å—è –æ—Ç –ú–∞—Ä–∫–∞ –∫ –ù–æ–≤–æ–¥–∞—á–Ω–æ–π'

def parser(link):
    req = requests.get(link)
    soup = b(req.text, 'html.parser')
    times = soup.find_all('span', class_='_time')
    all_times = [c.text for c in times]
    int_times = []
    print(all_times)
    now = datetime.now()
    current_time = now.strftime("%H:%M")
    print(current_time)
    for j in range(len(all_times)):
        str1 = all_times[j]
        a = int(str1[0]) * 1000 + int(str1[1]) * 100 + int(str1[3]) * 10 + int(str1[4])
        int_times.append(a)
    d = int(current_time[0]) * 1000 + int(current_time[1]) * 100 + int(current_time[3]) * 10 + int(current_time[4])
    for i in range(len(int_times)):
        if int_times[2 * i] > d:
            if int_times[2 * i] < 99:
                imsogladN1 = str(int_times[2 * i])
                imsoglad0 = str(int_times[2 * i + 2])
                return ('–°–ª–µ–¥—É—é—â–∞—è –±—É–¥–µ—Ç –≤ 00:'
                        + imsogladN1[0] + imsogladN1[1] + ', –Ω–æ –µ—Å–ª–∏ –Ω–µ —É—Å–ø–µ–≤–∞–µ—à—å, —Ç–æ –º–æ–∂–Ω–æ –Ω–∞ 00:' + imsoglad0[0]
                        + imsoglad0[1])
            if int_times[2 * i] < 999:
                imsoglad = str(int_times[2 * i])
                imsoglad2 = str(int_times[2 * i + 2])
                return ('–°–ª–µ–¥—É—é—â–∞—è –±—É–¥–µ—Ç –≤ 0' + imsoglad[0] + ':'
                        + imsoglad[1] + imsoglad[2] + ', –Ω–æ –µ—Å–ª–∏ –Ω–µ —É—Å–ø–µ–≤–∞–µ—à—å, —Ç–æ –º–æ–∂–Ω–æ –Ω–∞ 0' + imsoglad2[0] + ':'
                        + imsoglad2[1] + imsoglad2[2])
            if int_times[i] >= 999:
                imsoglad3 = str(int_times[2 * i])
                imsoglad4 = str(int_times[2 * i + 2])
                return ('–°–ª–µ–¥—É—é—â–∞—è –±—É–¥–µ—Ç –≤ ' + imsoglad3[0] + imsoglad3[1] + ':'
                        + imsoglad3[2] + imsoglad3[3] + ', –Ω–æ –µ—Å–ª–∏ –Ω–µ —É—Å–ø–µ–≤–∞–µ—à—å, —Ç–æ –º–æ–∂–Ω–æ –Ω–∞ ' + imsoglad4[0] +
                        imsoglad4[1] + ':' + imsoglad4[2] + imsoglad4[3])


bot = telebot.TeleBot(API_KEY)

keyboard1 = types.ReplyKeyboardMarkup(True)

@bot.message_handler(commands=['start'])
def start(message):
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
    item1 = types.KeyboardButton("–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—èü§ì")
    item2 = types.KeyboardButton("–†–∞—Å–ø–∏—Å–∞–Ω–∏–µüìÖ")
    item3 = types.KeyboardButton('–ò—Å—Ç–æ—Ä–∏—è-—Ä–∂–æ–º–±–∞üí£')
    markup.add(item1, item2, item3)
    question = f'<b>–ü—Ä–∏–≤–µ—Ç, {message.from_user.first_name}</b>!\n–ú–µ–Ω—è –∑–æ–≤—É—Ç –≠–ª–µ–∫—Ç—Ä–∏—á–∫–µ—Ä-–±–æ—Ç. –Ø —Ä–∞—Å—Å–∫–∞–∂—É –æ–± ' \
               f'—ç–ª–µ–∫—Ç—Ä–æ–ø–æ–µ–∑–¥–∞—Ö –°–∞–≤—ë–ª–æ–≤—Å–∫–æ–≥–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è, –ø–æ–º–æ–≥—É —Å–≤–∞–ª–∏—Ç—å —Å —Ñ–∏–∑—Ç–µ—Ö–∞, –º–æ–≥—É –¥–∞–∂–µ –ø–æ—à—É—Ç–∏—Ç—å (–µ—Å–ª–∏ ' \
               f'—Ä–∞–∑—Ä–µ—à–∏—à —Ä–∞–∑—Ä–µ—à–∏ –ø–æ–∂–∞–ª—É—Å—Ç–æüòä) \n–¢–∞–∫ —á—Ç–æ —Ç–µ–±–µ –Ω—É–∂–Ω–æ?'
    bot.send_message(message.chat.id, question, parse_mode='html', reply_markup=markup)
    markup.add(item1, item2, item3)

@bot.message_handler(content_types=['text'])
def text_message(message):
    if message.text == '–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ' or message.text == "–†–∞—Å–ø–∏—Å–∞–Ω–∏–µüìÖ":
        list_Timetable = parser(yandex)
        bot.send_message(message.chat.id, list_Timetable, parse_mode='html')
    if message.text == '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è' or message.text == "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—èü§ì":
        bot.send_message(message.chat.id, f'–í—ã–±–µ—Ä–∏ –º–æ–¥–µ–ª—å —ç–ª–µ–∫—Ç—Ä–∏—á–∫–∏: \n \n'
                                          f'‚åõ–ê—Ä—Ö–∏–≤–Ω—ã–µ: –≠–†2–†, –≠–†2–¢, –≠–î2–¢, –≠–î4–ú–ö, –≠–î4–ú–ö–ú-–ê–≠–†–û \n'
                                          f'‚öô–î–µ–π—Å—Ç–≤—É—é—â–∏–µ: –≠–î4–ú, –≠–ü2–î, –≠–ì2–¢–≤ "–ò–≤–æ–ª–≥–∞" \n'
                                          f'üèô–ë—É–¥—É—â–∏–µ: –≠–ì–≠2–¢–≤', parse_mode='html')
    if message.text == '–≠–†2–†' or message.text == '–≠—Ä2—Ä' or message.text == '—ç—Ä2—Ä':
        bot.send_photo(message.chat.id, photo='https://railgallery.ru/photo/00/99/84/99841.jpg', caption=er2r, parse_mode='html')
    if message.text == '–ò—Å—Ç–æ—Ä–∏—è-—Ä–∂–æ–º–±–∞' or message.text == '–∏—Å—Ç–æ—Ä–∏—è-—Ä–∂–æ–º–±–∞' or message.text == '–ò—Å—Ç–æ—Ä–∏—è-—Ä–∂–æ–º–±–∞üí£':
        bot.send_message(message.chat.id, f'–û–æ–æ, –≤–æ—Ç —ç—Ç–æ –ø–æ-–Ω–∞—à–µ–º—É! \n'
                                          f'–ö–∞–∫—É—é —Ö–æ—á–µ—à—å: –±–∞—è–Ω –∏–ª–∏ –ø–æ—Å–≤–µ–∂–µ–µ?')
    if message.text == '–ë–∞—è–Ω' or message.text == '–±–∞—è–Ω':
        bot.send_message(message.chat.id,
                         f'–°–≤–µ—Ç–∞–ª–æ... —Å–ª–µ–≥–∫–∞. –ù–∏—á–µ–≥–æ –Ω–µ –ø–æ–¥–æ–∑—Ä–µ–≤–∞—é—â–∏–π –º–∞—à–∏–Ω–∏—Å—Ç –Ω–∞–∏–≤–Ω–æ –≤–µ–ª —Å–≤–æ–π —ç–ª–µ–∫—Ç—Ä–æ–ø–æ–µ–∑–¥.'
                         f' –û–Ω –æ–ø—Ä–æ–º–µ—Ç—á–∏–≤–æ –∑–∞–±—ã–ª, —á—Ç–æ –ø–µ—Ä–≤–æ–µ –∞–ø—Ä–µ–ª—è —É–∂–µ –Ω–∞—Å—Ç—É–ø–∏–ª–æ. –ò–º–µ–Ω–Ω–æ –ø–æ—ç—Ç–æ–º—É –æ–Ω –æ—á–µ–Ω—å —É–¥–∏–≤–∏–ª—Å—è,'
                         f' –∫–æ–≥–¥–∞ —Ä–µ–ª—å—Å—ã –≤–¥—Ä—É–≥ –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å. –ë–µ–¥–Ω—ã–π –º–∞—à–∏–Ω–∏—Å—Ç... –†–∞–∑–≥–∞–¥–∫–∞ —ç—Ç–æ–π –Ω–µ–≥—É–º–∞–Ω–Ω–æ–π —à—É—Ç–∫–∏'
                         f' —Å–æ—Å—Ç–æ—è–ª–∞ –≤ —Ç–æ–º, —á—Ç–æ –∑–∞ –Ω–æ—á–Ω–æ–π –ø–µ—Ä–µ—Ä—ã–≤ –≤ —Ä–∞–±–æ—Ç–µ —ç–ª–µ–∫—Ç—Ä–∏—á–µ–∫ —Å—Ç—É–¥–µ–Ω—Ç—ã –ø–æ–∫—Ä–∞—Å–∏–ª–∏ —Ä–µ–ª—å—Å—ã –º–µ–∂–¥—É'
                         f' "–ù–æ–≤–æ–¥–∞—á–Ω–æ–π" –∏ "–î–æ–ª–≥–æ–ø—Ä—É–¥–Ω–æ–π" –≤ —á–µ—Ä–Ω—ã–π —Ü–≤–µ—Ç. –ß–µ—Ä–µ–∑ –≥–æ–¥ (–ø—Ä—è–º–æ –ø–µ—Ä–µ–¥ –ø–µ—Ä–≤—ã–º –∞–ø—Ä–µ–ª—è) –æ—Ç'
                         f' —ç–ª–µ–∫—Ç—Ä–æ–¥–µ–ø–æ –ø—Ä–∏—à–ª–∞ –≤ —Ä–µ–∫—Ç–æ—Ä–∞—Ç –ø—Ä–æ—Å—å–±–∞ ‚Äî —Ä–µ–ª—å—Å—ã –±–æ–ª—å—à–µ –Ω–µ –∫—Ä–∞—Å–∏—Ç—å.'
                         f' –î–∞ –∏ –º—ã —Å–∞–¥–∏—Å—Ç–∞–º–∏ –Ω–µ –±—ã–ª–∏ :)', parse_mode='html')
    if message.text == '–ü–æ—Å–≤–µ–∂–µ–µ' or message.text == '–ø–æ—Å–≤–µ–∂–µ–µ':
        bot.send_photo(message.chat.id, photo='https://sun9-66.userapi.com/impg/v03Vk-yKx6PCRdP8Ffe4ybtt-_jJzki2ha4Eiw/c-luThXtRsg.jpg?size=1455x739&quality=96&sign=1b3dda075a419f90763f7ab52e308746&type=album',
                         caption=f'–í 2020-–º –≥–æ–¥—É –†–ñ–î –ø–µ—Ä–µ–¥–∞–≤–∞–ª–æ –º–æ—Ç–æ—Ä–≤–∞–≥–æ–Ω–Ω–æ–µ –¥–µ–ø–æ "–õ–æ–±–Ω—è" –¶–ü–ü–ö. –ü–æ –∑–∞–∫–æ–Ω—É, –≤ —ç—Ç–æ—Ç –ø—Ä–æ—Ü–µ—Å—Å'
                         f' –º–æ–∂–µ—Ç –≤–≤—è–∑–∞—Ç—å—Å—è –∫—Ç–æ-—Ç–æ –¥—Ä—É–≥–æ–π, –∏ —Ö–æ—Ç—è –æ–±—ã—á–Ω–æ —ç—Ç–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–∞–ª–∞—Å—å —Ç–µ–Ω–¥–µ—Ä–∞–º–∏ —Å —É–∑–∫–∏–º–∏'
                         f' —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏, –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–º–∏ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –∫–æ–º–ø–∞–Ω–∏—é, –≤ —ç—Ç–æ—Ç —Ä–∞–∑ –º–æ–Ω–æ–ø–æ–ª–∏—Å—Ç —Ä–µ—à–∏–ª –ø—Ä–æ–±–ª–µ–º—É'
                         f' –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ: <b>–¥–µ–ø–æ –¢–ß-14 –õ–æ–±–Ω—è –±—ã–ª–æ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–æ –Ω–∞ –ê–≤–∏—Ç–æ</b>. –õ—é–±–æ–π –∂–µ–ª–∞—é—â–∏–π –º–æ–≥ —Å–≤—è–∑–∞—Ç—å—Å—è'
                         f' —Å –†–ñ–î –∏ –≤—Å–µ–≥–æ –∑–∞ 270 –º–ª–Ω —Ä—É–±–ª–µ–π –≤ –≥–æ–¥ –∞—Ä–µ–Ω–¥–æ–≤–∞—Ç—å –∏–º—É—â–µ—Å—Ç–≤–æ –≥–ª–∞–≤–Ω–æ–≥–æ —ç–ª–µ–∫—Ç—Ä–∏—á–∫–µ—Ä—Å–∫–æ–≥–æ'
                         f' –¥–µ–ø–æ –°–∞–≤—ë–ª–æ–≤—Å–∫–æ–≥–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è. –ò –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –¥–æ–≥–∞–¥—ã–≤–∞—Ç—å—Å—è, —Å–∫–æ–ª—å–∫–æ –ø—Ä–∏–∫–æ–ª–∏—Å—Ç–æ–≤ –ø–æ–∑–≤–æ–Ω–∏–ª–æ'
                         f' –Ω–∞ —ç—Ç–æ—Ç –±–µ–¥–Ω—ã–π –Ω–æ–º–µ—Ä...', parse_mode='html')
    if (message.text != '–ü–æ—Å–≤–µ–∂–µ–µ' and message.text != '–ë–∞—è–Ω' and message.text != '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è'
        and message.text != '–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ' and message.text != '–ò—Å—Ç–æ—Ä–∏—è-—Ä–∂–æ–º–±–∞' and message.text != '–ø–æ—Å–≤–µ–∂–µ–µ'
        and message.text != '–±–∞—è–Ω' and message.text != '–∏—Å—Ç–æ—Ä–∏—è-—Ä–∂–æ–º–±–∞' and message.text != '–≠–†2–†'
        and message.text != '–≠—Ä2—Ä' and message.text != '—ç—Ä2—Ä' and message.text != "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—èü§ì"
        and message.text  != "–ò—Å—Ç–æ—Ä–∏—è-—Ä–∂–æ–º–±–∞üí£" and message.text != "–†–∞—Å–ø–∏—Å–∞–Ω–∏–µüìÖ"):
        text1 = f'–Ø —Ç–∞–∫ –Ω–µ –∏–≥—Ä–∞—é :( \n{message.from_user.first_name}, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–ø—Ä–∞–≤—å —á—Ç–æ-–Ω–∏–±—É–¥—å –¥—Ä—É–≥–æ–µ!'
        bot.send_message(message.chat.id, text1, parse_mode='html')


bot.polling()
